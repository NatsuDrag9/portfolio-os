import{j as s}from"./jsx-runtime-D_zvdyIk.js";import{A as S,D as B,F as H,a as M,R as Y}from"./store-BKo5rbBN.js";import{r as d}from"./index-DvOVhSYJ.js";import{r as J}from"./index-BYLy_Wld.js";import{u as Q}from"./useClickOutsideModal-CtMuagMQ.js";function D({windowData:n,appId:o,onFocus:c,onClose:p}){const[_,h]=d.useState(!1),t=S.find(r=>r.id===o),x=d.useCallback(()=>{if(typeof(t==null?void 0:t.desktopIcon)=="string")return t!=null&&t.mobileIcon&&typeof t.mobileIcon=="string"?`${t.mobileIcon} 1x, ${t.desktopIcon} 2x`:t.desktopIcon},[t.desktopIcon,t.mobileIcon]),f=n.title||(t==null?void 0:t.appName)||"Window",u=r=>{r.stopPropagation(),r.preventDefault();const w=n.id;!w||!p||(h(!0),setTimeout(()=>{p(w)},H))},g=()=>{n.id&&c&&c(n.id)},y=()=>{if(typeof t.desktopIcon!="string"){const w=t.desktopIcon;return s.jsx(w,{className:"active-windows-popup__fluent-icon"})}return s.jsx("img",{src:t==null?void 0:t.desktopIcon,className:"active-windows-popup__applogo",alt:f,srcSet:x()})};return s.jsxs("div",{className:`active-windows-popup ${_?"active-windows-popup--exiting":""}`,onClick:g,onKeyDown:r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),g())},role:"button",tabIndex:0,title:f,children:[y(),s.jsx("p",{className:"active-windows-popup__appname",children:f}),s.jsx("button",{type:"button",title:"Close",className:"active-windows-popup__close-button",onClick:u,onMouseDown:r=>r.stopPropagation(),onTouchStart:r=>r.stopPropagation(),children:s.jsx(B,{className:"active-windows-popup__fluent-icon"})})]})}D.__docgenInfo={description:"",methods:[],displayName:"ActiveWindowsPopup",props:{windowData:{required:!0,tsType:{name:"WindowData"},description:""},appId:{required:!0,tsType:{name:"string"},description:""},onFocus:{required:!1,tsType:{name:"signature",type:"function",raw:"(windowId: string) => void",signature:{arguments:[{type:{name:"string"},name:"windowId"}],return:{name:"void"}}},description:""},onClose:{required:!1,tsType:{name:"signature",type:"function",raw:"(windowId: string) => void",signature:{arguments:[{type:{name:"string"},name:"windowId"}],return:{name:"void"}}},description:""}}};function X({appId:n,iconVariant:o,isOpen:c=!1,isPinned:p=!1,onClose:_,onClick:h,anchorElement:t}){const{activeWindows:x}=M(),f=d.useRef(null),u=S.find(e=>e.id===n),y=x.filter(e=>{var i;return(i=e.id)==null?void 0:i.startsWith(`${n}-`)}).length,r=y>0,w=y>1,k=d.useMemo(()=>{if(!t||!c)return{top:0,left:0};const e=t.getBoundingClientRect();return o==="taskbar"?{top:e.top-70,left:e.left+40}:{top:e.bottom-15,left:e.right-15}},[t,c,o]);Q(c,_||(()=>{}),f);const v=e=>!e||e==="always"?!0:e==="pinned"?p:e==="unpinned"?!p:e==="has-windows"?r:e==="has-multiple-windows"?w:!0,T=e=>{h&&h(n,e,o)},I=Y[o],N=s.jsx("div",{className:`rc-menu ${o==="taskbar"?"rc-menu--top-right":"rc-menu--bottom-right"}`,ref:f,role:"menu",tabIndex:0,style:{position:"fixed",top:`${k.top}px`,left:`${k.left}px`},children:I.filter(e=>v(e.showWhen)).map(e=>{var A,b;const i=((A=e.iconSource)==null?void 0:A.type)==="fluent"?e.iconSource.icon:null;return s.jsxs("div",{className:`rc-menu__item ${e.destructive?"rc-menu__item--destructive":""}`,role:"menuitem",tabIndex:0,onClick:m=>{m.stopPropagation(),T(e.id)},onKeyDown:m=>{m.key==="Enter"&&(m.preventDefault(),m.stopPropagation(),T(e.id))},title:e.label,children:[s.jsxs("span",{className:"rc-menu__item-icon",children:[((b=e.iconSource)==null?void 0:b.type)==="app-registry"&&u&&(()=>{if(typeof u.desktopIcon!="string"){const j=u.desktopIcon;return s.jsx(j,{className:"rc-menu__item-app-icon"})}return s.jsx("img",{src:u.mobileIcon||u.desktopIcon,alt:"",className:"rc-menu__item-app-icon"})})(),i&&s.jsx(i,{className:"rc-menu__item-fluent-icon"})]}),s.jsx("span",{className:"rc-menu__item-label",children:e.label})]},e.id)})});return c?J.createPortal(N,document.body):null}const Z=20,V=30;function ee(n,o){let c;switch(o){case"start-menu":c=Z;break;case"desktop":c=V;break;case"taskbar":return n;default:return n}return n.length<=c?n:`${n.slice(0,c-3)}...`}const ne=(n,o)=>n?o?"app-icon__dot--focused":"app-icon__dot--unfocused":"app-icon__dot--hidden",te=(n,o,c)=>{const p=[];return n==="taskbar"?(p.push("app-icon--taskbar"),o&&p.push("app-icon--multiple-windows"),c&&p.push("app-icon--taskbar-focused")):n==="desktop"?p.push("app-icon--desktop"):n==="start-menu"&&p.push("app-icon--start-menu"),p.join(" ")},se=600;function oe({appId:n,iconVariant:o,shape:c,onSingleClick:p,onDoubleClick:_,onRightClick:h,onWindowFocus:t,onWindowClose:x,isPinned:f=!1,onContextMenuItemClick:u}){var q;const{activeWindows:g}=M(),[y,r]=d.useState(!1),[w,k]=d.useState(!1),[v,T]=d.useState(!1),I=d.useRef(null),[N,e]=d.useState(null),i=S.find(a=>a.id===n),b=g.filter(a=>{var l;return(l=a.id)==null?void 0:l.startsWith(`${n}-`)}).length,m=b>0,j=b>1,L=()=>{I.current&&(clearTimeout(I.current),I.current=null),k(!1),r(!0)},O=()=>{k(!0),I.current=setTimeout(()=>{r(!1),k(!1)},se)};d.useEffect(()=>()=>{I.current&&clearTimeout(I.current)},[]);const C=g.length>0?g.reduce((a,l)=>a.zIndex>l.zIndex?a:l):null,W=(((q=C==null?void 0:C.id)==null?void 0:q.startsWith(`${n}-`))&&C.isMaximized)??!1,F=()=>{o!=="desktop"&&p&&p(n)},R=()=>{o==="desktop"&&_&&_(n)},U=()=>{T(!0),h&&h(n)},P=()=>{T(!1)},E=i&&typeof i.desktopIcon!="string",$=E?i.desktopIcon:null,K=!E&&(i!=null&&i.mobileIcon)?`${i.mobileIcon} 1x, ${i.desktopIcon} 2x`:E||i==null?void 0:i.desktopIcon,G=a=>{if(a.key==="Enter"||a.key===" "){if(a.preventDefault(),o==="desktop"){R();return}F()}};return i?s.jsxs("div",{ref:e,className:`app-icon ${c} ${te(o,j,!!W)}`,role:"button",tabIndex:0,onDoubleClick:R,onClick:F,onKeyDown:G,onContextMenu:U,title:i.appName,onMouseEnter:L,onMouseLeave:O,children:[$?s.jsx($,{className:"app-icon__image app-icon__image--fluent"}):s.jsx("img",{srcSet:K,src:i.desktopIcon,className:"app-icon__image",alt:i.appName}),o!=="taskbar"&&s.jsx("span",{className:"app-icon__name",children:ee(i.appName,o)}),o==="taskbar"&&s.jsxs(s.Fragment,{children:[s.jsx("span",{className:`app-icon__dot ${ne(m,!!W)}`}),y&&m&&!v&&s.jsx("div",{className:`app-icon__popup-container ${w?"app-icon__popup-container--exiting":""}`,children:g.filter(a=>{var l;return(l=a.id)==null?void 0:l.startsWith(`${n}-`)}).map(a=>s.jsx(D,{windowData:a,appId:n,onFocus:t,onClose:x},a.id))})]}),v&&s.jsx(X,{appId:n,iconVariant:o,isPinned:f,onClick:(a,l,z)=>{u&&u(a,l,z),P()},isOpen:v,onClose:P,anchorElement:N})]}):null}oe.__docgenInfo={description:"",methods:[],displayName:"AppIcon",props:{appId:{required:!0,tsType:{name:"string"},description:""},iconVariant:{required:!0,tsType:{name:"AppIconVariant"},description:""},shape:{required:!1,tsType:{name:"IconShapeType"},description:""},onSingleClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(appId: string) => void",signature:{arguments:[{type:{name:"string"},name:"appId"}],return:{name:"void"}}},description:""},onDoubleClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(appId: string) => void",signature:{arguments:[{type:{name:"string"},name:"appId"}],return:{name:"void"}}},description:""},onRightClick:{required:!1,tsType:{name:"signature",type:"function",raw:"(appId: string) => void",signature:{arguments:[{type:{name:"string"},name:"appId"}],return:{name:"void"}}},description:""},onWindowFocus:{required:!1,tsType:{name:"signature",type:"function",raw:"(windowId: string) => void",signature:{arguments:[{type:{name:"string"},name:"windowId"}],return:{name:"void"}}},description:""},onWindowClose:{required:!1,tsType:{name:"signature",type:"function",raw:"(windowId: string) => void",signature:{arguments:[{type:{name:"string"},name:"windowId"}],return:{name:"void"}}},description:""},isPinned:{required:!1,tsType:{name:"boolean"},description:"",defaultValue:{value:"false",computed:!1}},onContextMenuItemClick:{required:!1,tsType:{name:"signature",type:"function",raw:`(
  appId: string,
  action: AppIconRightClickActionType,
  variant: AppIconVariant
) => void`,signature:{arguments:[{type:{name:"string"},name:"appId"},{type:{name:"AppIconRightClickActionType"},name:"action"},{type:{name:"AppIconVariant"},name:"variant"}],return:{name:"void"}}},description:""}}};export{oe as A};
